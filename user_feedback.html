<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TeamGalaxy — Share Praise</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#071025;
      --card:#0b1220;
      --muted:#9fb4c9;
      --accent:#6d28d9;
      --accent-2:#06b6d4;
      --glass:rgba(255,255,255,0.03);
      --radius:14px;
      --shadow:0 10px 30px rgba(2,6,23,0.6);
    }

    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#041026 0%, #071025 60%);color:#e8f4ff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}

    /* page container */
    .page {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:48px 24px;
      box-sizing:border-box;
    }

    /* layout */
    .container {
      width:100%;
      max-width:980px;
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:28px;
      align-items:start;
    }

    /* left hero / content */
    .hero {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:28px;
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,0.03);
    }
    .brand {
      display:flex;
      gap:14px;
      align-items:center;
    }
    .brand-mark {
      width:64px;height:64px;border-radius:12px;display:grid;place-items:center;font-weight:800;color:white;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      box-shadow:0 8px 28px rgba(13,30,60,0.35);
      font-size:20px;
    }
    h1 { margin:0; font-size:22px; font-weight:700; }
    p.lead { margin:8px 0 0; color:var(--muted); font-size:14px; max-width:70ch; line-height:1.5 }

    /* praise examples card */
    .sample {
      margin-top:18px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
    .chip {
      background:rgba(255,255,255,0.02);
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.02);
      color:var(--muted);
      font-size:13px;
    }

    /* right panel (form) */
    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    label { display:block; font-size:13px; color:var(--muted); margin-bottom:8px; }
    textarea { width:100%; min-height:130px; resize:vertical; padding:12px 14px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); background:var(--glass); color:inherit; font-size:15px; outline:none }
    textarea::placeholder { color: rgba(230,240,251,0.55) }
    input[type="number"] { padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.03); background:var(--glass); color:inherit; width:100% }

    /* rating stars row */
    .rating-row { display:flex; gap:12px; align-items:center; }
    .stars { display:flex; gap:8px; align-items:center; }
    .star {
      font-size:28px;
      cursor:pointer;
      transition:transform .12s ease, opacity .12s ease;
      opacity:0.92;
      color:rgba(255,255,255,0.18);
      text-shadow:0 6px 18px rgba(0,0,0,0.5);
      user-select:none;
    }
    .star:hover{ transform:translateY(-6px) scale(1.06) }
    .star.active { color:#ffd54a; filter:drop-shadow(0 6px 20px rgba(255,213,74,0.12)); opacity:1; }

    /* controls */
    .controls { display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:6px }
    .left-controls { display:flex; gap:12px; align-items:center; }
    .submit {
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      border:0;
      padding:12px 16px;
      color:white;
      font-weight:600;
      border-radius:10px;
      cursor:pointer;
      box-shadow:0 8px 26px rgba(109,40,217,0.12);
      transition:transform .08s ease;
    }
    .submit:active { transform:translateY(1px) }
    .meta { color:var(--muted); font-size:13px; }

    /* small toggle / anon line */
    .toggle-row { display:flex; gap:10px; align-items:center; justify-content:space-between; }
    .toggle-left { display:flex; gap:10px; align-items:center; }
    .toggle-left input[type="checkbox"] { width:18px; height:18px; accent-color:var(--accent) }

    .hint { font-size:13px; color:var(--muted) }

    /* message area */
    .message { margin-top:10px; font-size:14px; }
    .success { background:linear-gradient(90deg,#059669,#10b981); padding:10px 12px; border-radius:10px; color:white }
    .error { background:linear-gradient(90deg,#ef4444,#fb923c); padding:10px 12px; border-radius:10px; color:white }

    /* footer small */
    .foot { margin-top:18px; text-align:center; color:var(--muted); font-size:13px }

    /* professional responsive */
    @media (max-width:980px) {
      .container { grid-template-columns: 1fr; }
      .panel { order:2 }
      .hero { order:1 }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="container" role="main">
      <!-- Left hero / context -->
      <section class="hero" aria-labelledby="title">
        <div class="brand">
          <div class="brand-mark" aria-hidden="true">TG</div>
          <div>
            <h1 id="title">Share a quick praise</h1>
            <p class="lead">Tell us what you enjoyed. Short, positive notes that brighten the team’s day. (This is not a support channel — no replies.)</p>
          </div>
        </div>

        <div class="sample" aria-hidden="true">
          <div class="chip">Loved the smooth login flow</div>
          <div class="chip">That new animation looked great</div>
          <div class="chip">Super helpful onboarding</div>
          <div class="chip">Great customer experience!</div>
        </div>

        <div style="margin-top:18px" class="hint">
          A little praise goes a long way. Keep it short and kind — the team reads these regularly.
        </div>
      </section>

      <!-- Right form panel -->
      <aside class="panel" aria-labelledby="formTitle">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-weight:600;font-size:15px" id="formTitle">Send praise ✨</div>
            <div class="hint" id="signedInfo" style="display:none;margin-top:6px"></div>
          </div>
          <div style="opacity:0.9;color:var(--muted);font-size:13px" id="refPreview">Ref: —</div>
        </div>

        <form id="praiseForm" autocomplete="off" novalidate>
          <div>
            <label for="message">Your praise</label>
            <textarea id="message" placeholder="What did you like? (20 characters minimum)" required minlength="20" aria-label="Praise message"></textarea>
          </div>

          <div style="margin-top:8px">
            <label>Rating</label>
            <div class="rating-row">
              <div class="stars" id="starContainer" aria-hidden="true"></div>
              <div style="flex:1;display:flex;justify-content:flex-end;align-items:center">
                <input id="ratingValue" type="number" min="1" max="5" value="5" aria-label="Numeric rating" />
              </div>
            </div>
          </div>

          <div style="margin-top:10px" class="toggle-row">
            <div class="toggle-left">
              <input type="checkbox" id="isAnon" checked aria-label="Submit anonymously" />
              <label for="isAnon" class="hint">Submit anonymously</label>
            </div>
            <div class="meta">Category: <strong style="margin-left:6px">Praise</strong></div>
          </div>

          <div class="controls">
            <div class="left-controls">
              <button class="submit" type="submit" id="submitBtn">Send Praise</button>
              <div id="msgBox" aria-live="polite"></div>
            </div>
            <div class="meta" id="statusMeta"></div>
          </div>
        </form>

        <div class="foot">No screenshots or follow-ups here — just good vibes.</div>
      </aside>
    </div>
  </div>

  <!-- Firebase + logic (SDK v11.9.0). Keep as module. -->
  <script type="module">
    // =========== Firebase config (provided) ===========
    const firebaseConfig = {
      apiKey: "AIzaSyD0Yv_bQjxi2_kjzPR4XHOlaB7Sb6NRVUc",
      authDomain: "teamgalaxy-77344.firebaseapp.com",
      projectId: "teamgalaxy-77344",
      storageBucket: "teamgalaxy-77344.firebasestorage.app",
      messagingSenderId: "770256225320",
      appId: "1:770256225320:web:5a363ebd757de6cde3a11d",
      measurementId: "G-6C2W9NSNCH"
    };
    // =================================================

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js';
    import { getFirestore, collection, addDoc, serverTimestamp, updateDoc } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js';

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // ---------- Helpers ----------
    function getClientId() {
      const key = 'teamgalaxy:clientId:v1';
      let id = localStorage.getItem(key);
      if (!id) {
        if (crypto && typeof crypto.randomUUID === 'function') id = crypto.randomUUID();
        else id = 'cid-' + Math.floor(Math.random()*1e9).toString(36) + '-' + Date.now().toString(36);
        localStorage.setItem(key, id);
      }
      return id;
    }

    async function digestUTF8(message) {
      const enc = new TextEncoder();
      const data = enc.encode(message);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    async function getFingerprint() {
      try {
        const clientId = getClientId();
        const f = [navigator.userAgent || '', navigator.platform || '', Intl.DateTimeFormat().resolvedOptions().timeZone || '', clientId].join('||');
        return await digestUTF8(f);
      } catch { return null; }
    }

    function shortRefFromId(id) {
      return `FB-${(new Date()).toISOString().slice(0,10).replace(/-/g,'')}-${id.slice(0,6).toUpperCase()}`;
    }

    // ---------- UI wiring ----------
    const starContainer = document.getElementById('starContainer');
    const ratingValue = document.getElementById('ratingValue');
    const messageEl = document.getElementById('message');
    const isAnon = document.getElementById('isAnon');
    const submitBtn = document.getElementById('submitBtn');
    const msgBox = document.getElementById('msgBox');
    const refPreview = document.getElementById('refPreview');
    const signedInfo = document.getElementById('signedInfo');
    const statusMeta = document.getElementById('statusMeta');

    function renderStars(n = 5) {
      starContainer.innerHTML = '';
      for (let i = 1; i <= 5; i++) {
        const s = document.createElement('span');
        s.className = 'star' + (i <= n ? ' active' : '');
        s.textContent = '★';
        s.dataset.value = i;
        s.title = `${i} star${i>1?'s':''}`;
        s.addEventListener('click', () => { ratingValue.value = i; renderStars(i); });
        starContainer.appendChild(s);
      }
    }
    renderStars(5);

    ratingValue.addEventListener('input', () => {
      let v = parseInt(ratingValue.value, 10);
      if (isNaN(v) || v < 1) v = 1;
      if (v > 5) v = 5;
      ratingValue.value = v;
      renderStars(v);
    });

    // Auth behaviour: encourage signed users to show name
    let currentUser = null;
    let signedDefaultAnon = true;
    onAuthStateChanged(auth, (u) => {
      currentUser = u;
      if (u) {
        signedDefaultAnon = false;
        signedInfo.style.display = 'block';
        signedInfo.textContent = `Signed in as ${u.displayName || (u.email ? u.email.split('@')[0] : u.uid.slice(0,6))}. You may hide your name but sharing it helps the team know who to thank.`;
        isAnon.checked = false;
        statusMeta.textContent = 'You are signed in';
      } else {
        signedDefaultAnon = true;
        signedInfo.style.display = 'none';
        isAnon.checked = true;
        statusMeta.textContent = '';
      }
      // preview ref using clientId snippet
      const fake = getClientId().slice(0,6).toUpperCase();
      refPreview.textContent = `Ref: FB-${new Date().toISOString().slice(0,10).replace(/-/g,'')}-${fake}`;
    });

    function showMessage(text, type = 'ok') {
      msgBox.innerHTML = '';
      const d = document.createElement('div');
      d.className = type === 'ok' ? 'success' : 'error';
      d.textContent = text;
      msgBox.appendChild(d);
    }

    // Submit logic
    let busy = false;
    document.getElementById('praiseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (busy) return;
      busy = true;
      submitBtn.disabled = true;
      msgBox.innerHTML = '';

      const message = messageEl.value.trim();
      const rating = parseInt(ratingValue.value, 10) || 5;
      const wantAnon = isAnon.checked;

      if (message.length < 20) {
        showMessage('Please add a bit more — 20 characters minimum.', 'err');
        busy = false; submitBtn.disabled = false;
        return;
      }

      try {
        const fingerprint = await getFingerprint();
        const clientId = getClientId();
        const authorId = (currentUser && !wantAnon) ? currentUser.uid : null;
        const authorName = (currentUser && !wantAnon) ? (currentUser.displayName || null) : null;

        const payload = {
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp(),
          rating,
          category: 'praise',
          message,
          status: 'closed_as_praise',
          visible: true,
          clientId,
          fingerprint,
          clientLocale: navigator.language || null,
          userId: authorId,
          displayName: authorName,
          anonymousSubmission: !!wantAnon
        };

        const col = collection(db, 'feedback');
        const docRef = await addDoc(col, payload);
        const refId = shortRefFromId(docRef.id);
        await updateDoc(docRef, { refId, updatedAt: serverTimestamp() });

        refPreview.textContent = `Ref: ${refId}`;
        showMessage('Thanks — your praise brightened our day ✨', 'ok');

        messageEl.value = '';
        ratingValue.value = 5;
        renderStars(5);
        isAnon.checked = signedDefaultAnon;
      } catch (err) {
        console.error('Submit failed', err);
        showMessage('Submission failed — please try again shortly.', 'err');
      } finally {
        busy = false;
        submitBtn.disabled = false;
      }
    });

    // accessibility: focus textarea on load
    window.addEventListener('load', () => { setTimeout(()=> messageEl.focus(), 220); });

  </script>
</body>
</html>