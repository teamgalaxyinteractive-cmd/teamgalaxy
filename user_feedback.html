<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TeamGalaxy — Share Praise</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#061025;
      --muted:#9fb4c9;
      --accent:#6d28d9;
      --accent-2:#06b6d4;
      --glass:rgba(255,255,255,0.03);
      --radius:14px;
      --shadow:0 10px 30px rgba(2,6,23,0.6);
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#031026 0%, #061025 60%);color:#e8f4ff; -webkit-font-smoothing:antialiased}
    .page{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:48px 24px;box-sizing:border-box;position:relative;overflow:hidden}
    /* starfield canvas behind everything */
    canvas#starfield{position:fixed;inset:0;width:100%;height:100%;z-index:0;pointer-events:none;opacity:0.95}
    .container{position:relative;z-index:2;width:100%;max-width:980px;display:grid;grid-template-columns:1fr 360px;gap:28px;align-items:start}
    .hero{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius);padding:28px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.03)}
    .brand{display:flex;gap:14px;align-items:center}
    .brand-img{
      width:64px;height:64px;border-radius:12px;display:inline-grid;place-items:center;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 8px 28px rgba(13,30,60,0.35);font-size:20px;overflow:hidden;
    }
    .brand-img img{width:100%;height:100%;object-fit:cover;display:block}
    h1{margin:0;font-size:22px;font-weight:700}
    p.lead{margin:8px 0 0;color:var(--muted);font-size:14px;max-width:70ch;line-height:1.5}
    .sample{margin-top:18px;display:flex;gap:12px;flex-wrap:wrap}
    .chip{background:rgba(255,255,255,0.02);padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.02);color:var(--muted);font-size:13px}
    .panel{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius);padding:22px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:14px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:8px}
    textarea{width:100%;min-height:130px;resize:vertical;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:inherit;font-size:15px;outline:none}
    textarea::placeholder{color:rgba(230,240,251,0.55)}
    input[type="number"]{padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:inherit;width:100%}
    .rating-row{display:flex;gap:12px;align-items:center}
    .stars{display:flex;gap:8px;align-items:center}
    .star{font-size:28px;cursor:pointer;transition:transform .12s, opacity .12s;color:rgba(255,255,255,0.18);text-shadow:0 6px 18px rgba(0,0,0,0.5);user-select:none}
    .star:hover{transform:translateY(-6px) scale(1.06)}
    .star.active{color:#ffd54a;filter:drop-shadow(0 6px 20px rgba(255,213,74,0.12));opacity:1}
    .controls{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-top:6px}
    .submit{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:0;padding:12px 16px;color:white;font-weight:600;border-radius:10px;cursor:pointer;box-shadow:0 8px 26px rgba(109,40,217,0.12)}
    .submit:active{transform:translateY(1px)}
    .meta{color:var(--muted);font-size:13px}
    .toggle-row{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .toggle-left{display:flex;gap:10px;align-items:center}
    .toggle-left input[type="checkbox"]{width:18px;height:18px;accent-color:var(--accent)}
    .hint{font-size:13px;color:var(--muted)}
    .message{margin-top:10px;font-size:14px}
    .success{background:linear-gradient(90deg,#059669,#10b981);padding:10px 12px;border-radius:10px;color:white}
    .error{background:linear-gradient(90deg,#ef4444,#fb923c);padding:10px 12px;border-radius:10px;color:white}
    .foot{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:980px){.container{grid-template-columns:1fr}.panel{order:2}.hero{order:1}}
  </style>
</head>
<body>
  <div class="page">
    <!-- starfield canvas -->
    <canvas id="starfield" aria-hidden="true"></canvas>

    <div class="container" role="main">
      <!-- Left hero -->
      <section class="hero" aria-labelledby="title">
        <div class="brand">
          <div class="brand-img" title="Replace this image by setting #brandImg src">
            <!-- Replace the src or the data-src below with your logo URL -->
            <img id="brandImg" src="https://dl.dropboxusercontent.com/scl/fi/v5d7xte4tksarsdufk4ay/image.png?rlkey=ca8p4jsfcw1pnqr79q8uympso&st=ikst5uy1&dl=0" alt="TeamGalaxy logo placeholder" />
          </div>
          <div>
            <h1 id="title">Share a quick praise</h1>
            <p class="lead">Short, positive notes that make the team smile. This is not a support channel — the team will not reply from here.</p>
          </div>
        </div>

        <div class="sample" aria-hidden="true">
          <div class="chip">Loved the new animation</div>
          <div class="chip">Signup flow was smooth</div>
          <div class="chip">Great onboarding tips</div>
          <div class="chip">Enjoyed the UX</div>
        </div>

        <div style="margin-top:18px" class="hint">
          Keep it short and kind — the team reads these regularly.
        </div>
      </section>

      <!-- Right form -->
      <aside class="panel" aria-labelledby="formTitle">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-weight:600;font-size:15px" id="formTitle">Send praise ✨</div>
            <div class="hint" id="signedInfo" style="display:none;margin-top:6px"></div>
          </div>
          <div style="opacity:0.9;color:var(--muted);font-size:13px" id="refPreview">Ref: —</div>
        </div>

        <form id="praiseForm" autocomplete="off" novalidate>
          <div>
            <label for="message">Your praise</label>
            <textarea id="message" placeholder="What did you like? (20 characters minimum)" required minlength="20" aria-label="Praise message"></textarea>
          </div>

          <div style="margin-top:8px">
            <label>Rating</label>
            <div class="rating-row">
              <div class="stars" id="starContainer" aria-hidden="true"></div>
              <div style="flex:1;display:flex;justify-content:flex-end;align-items:center">
                <input id="ratingValue" type="number" min="1" max="5" value="5" aria-label="Numeric rating" />
              </div>
            </div>
          </div>

          <div style="margin-top:10px" class="toggle-row">
            <div class="toggle-left">
              <input type="checkbox" id="isAnon" checked aria-label="Submit anonymously" />
              <label for="isAnon" class="hint">Submit anonymously</label>
            </div>
            <div class="meta">Category: <strong style="margin-left:6px">Praise</strong></div>
          </div>

          <div class="controls">
            <div style="display:flex;gap:12px;align-items:center">
              <button class="submit" type="submit" id="submitBtn">Send Praise</button>
              <div id="msgBox" aria-live="polite"></div>
            </div>
            <div class="meta" id="statusMeta"></div>
          </div>
        </form>

        <div class="foot">No screenshots or follow-ups here — just good vibes.</div>
      </aside>
    </div>
  </div>

  <!-- Firebase + app (SDK v11.9.0) -->
  <script type="module">
    // =========== Firebase config (provided) ===========
    const firebaseConfig = {
      apiKey: "AIzaSyD0Yv_bQjxi2_kjzPR4XHOlaB7Sb6NRVUc",
      authDomain: "teamgalaxy-77344.firebaseapp.com",
      projectId: "teamgalaxy-77344",
      storageBucket: "teamgalaxy-77344.firebasestorage.app",
      messagingSenderId: "770256225320",
      appId: "1:770256225320:web:5a363ebd757de6cde3a11d",
      measurementId: "G-6C2W9NSNCH"
    };
    // =================================================

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js';
    import { getFirestore, collection, addDoc, serverTimestamp, updateDoc } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js';

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // ---------- Helpers ----------
    function getClientId() {
      const key = 'teamgalaxy:clientId:v1';
      let id = localStorage.getItem(key);
      if (!id) {
        if (crypto && typeof crypto.randomUUID === 'function') id = crypto.randomUUID();
        else id = 'cid-' + Math.floor(Math.random()*1e9).toString(36) + '-' + Date.now().toString(36);
        localStorage.setItem(key, id);
      }
      return id;
    }

    async function digestUTF8(message) {
      const enc = new TextEncoder();
      const data = enc.encode(message);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    async function getFingerprint() {
      try {
        const clientId = getClientId();
        const f = [navigator.userAgent || '', navigator.platform || '', Intl.DateTimeFormat().resolvedOptions().timeZone || '', clientId].join('||');
        return await digestUTF8(f);
      } catch { return null; }
    }

    function shortRefFromId(id) {
      return `FB-${(new Date()).toISOString().slice(0,10).replace(/-/g,'')}-${id.slice(0,6).toUpperCase()}`;
    }

    // ---------- UI wiring ----------
    const starContainer = document.getElementById('starContainer');
    const ratingValue = document.getElementById('ratingValue');
    const messageEl = document.getElementById('message');
    const isAnon = document.getElementById('isAnon');
    const submitBtn = document.getElementById('submitBtn');
    const msgBox = document.getElementById('msgBox');
    const refPreview = document.getElementById('refPreview');
    const signedInfo = document.getElementById('signedInfo');
    const statusMeta = document.getElementById('statusMeta');

    function renderStars(n = 5) {
      starContainer.innerHTML = '';
      for (let i = 1; i <= 5; i++) {
        const s = document.createElement('span');
        s.className = 'star' + (i <= n ? ' active' : '');
        s.textContent = '★';
        s.dataset.value = i;
        s.title = `${i} star${i>1?'s':''}`;
        s.addEventListener('click', () => { ratingValue.value = i; renderStars(i); });
        starContainer.appendChild(s);
      }
    }
    renderStars(5);

    ratingValue.addEventListener('input', () => {
      let v = parseInt(ratingValue.value, 10);
      if (isNaN(v) || v < 1) v = 1;
      if (v > 5) v = 5;
      ratingValue.value = v;
      renderStars(v);
    });

    // Auth: encourage signed users to leave name (still optional)
    let currentUser = null;
    let signedDefaultAnon = true;
    onAuthStateChanged(auth, (u) => {
      currentUser = u;
      if (u) {
        signedDefaultAnon = false;
        signedInfo.style.display = 'block';
        signedInfo.textContent = `Signed in as ${u.displayName || (u.email ? u.email.split('@')[0] : u.uid.slice(0,6))}. Showing your name helps us know who to thank.`;
        isAnon.checked = false;
        statusMeta.textContent = 'Signed in';
      } else {
        signedDefaultAnon = true;
        signedInfo.style.display = 'none';
        isAnon.checked = true;
        statusMeta.textContent = '';
      }
      // preview ref using client id snippet
      const fake = getClientId().slice(0,6).toUpperCase();
      refPreview.textContent = `Ref: FB-${new Date().toISOString().slice(0,10).replace(/-/g,'')}-${fake}`;
    });

    function showMessage(text, type = 'ok') {
      msgBox.innerHTML = '';
      const d = document.createElement('div');
      d.className = type === 'ok' ? 'success' : 'error';
      d.textContent = text;
      msgBox.appendChild(d);
    }

    // Submit logic
    let busy = false;
    document.getElementById('praiseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (busy) return;
      busy = true;
      submitBtn.disabled = true;
      msgBox.innerHTML = '';

      const message = messageEl.value.trim();
      const rating = parseInt(ratingValue.value, 10) || 5;
      const wantAnon = isAnon.checked;

      if (message.length < 20) {
        showMessage('Please add a bit more — 20 characters minimum.', 'err');
        busy = false; submitBtn.disabled = false;
        return;
      }

      try {
        const fingerprint = await getFingerprint();
        const clientId = getClientId();
        const authorId = (currentUser && !wantAnon) ? currentUser.uid : null;
        const authorName = (currentUser && !wantAnon) ? (currentUser.displayName || null) : null;

        const payload = {
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp(),
          rating,
          category: 'praise',
          message,
          status: 'closed_as_praise',
          visible: true,
          clientId,
          fingerprint,
          clientLocale: navigator.language || null,
          userId: authorId,
          displayName: authorName,
          anonymousSubmission: !!wantAnon
        };

        const col = collection(db, 'feedback');
        const docRef = await addDoc(col, payload);
        const refId = shortRefFromId(docRef.id);
        await updateDoc(docRef, { refId, updatedAt: serverTimestamp() });

        refPreview.textContent = `Ref: ${refId}`;
        showMessage('Thanks — your praise brightened our day ✨', 'ok');

        messageEl.value = '';
        ratingValue.value = 5;
        renderStars(5);
        isAnon.checked = signedDefaultAnon;
      } catch (err) {
        console.error('Submit failed', err);
        showMessage('Submission failed — please try again shortly.', 'err');
      } finally {
        busy = false;
        submitBtn.disabled = false;
      }
    });

    // focus textarea for accessibility
    window.addEventListener('load', () => { setTimeout(()=> messageEl.focus(), 220); });

    // ---------- Starfield animation (lightweight, interactive) ----------
    (function initStarfield(){
      const canvas = document.getElementById('starfield');
      const ctx = canvas.getContext('2d');
      let w = canvas.width = innerWidth;
      let h = canvas.height = innerHeight;
      const stars = [];
      const density = Math.max(40, Math.round((w*h)/14000)); // keep CPU reasonable
      for (let i=0;i<density;i++){
        stars.push({
          x: Math.random()*w,
          y: Math.random()*h,
          r: Math.random()*1.4 + 0.4,
          a: Math.random()*0.8 + 0.2,
          vx: (Math.random()-0.5)*0.04,
          vy: (Math.random()-0.5)*0.04,
          tw: Math.random()*Math.PI*2
        });
      }
      let mouseX = w/2, mouseY = h/2;
      window.addEventListener('resize', ()=>{ w = canvas.width = innerWidth; h = canvas.height = innerHeight; });
      window.addEventListener('mousemove', (e)=>{ mouseX = e.clientX; mouseY = e.clientY; });

      function draw(){
        ctx.clearRect(0,0,w,h);
        // subtle vignette
        const g = ctx.createLinearGradient(0,0,0,h);
        g.addColorStop(0,'rgba(2,6,18,0.06)');
        g.addColorStop(1,'rgba(0,0,0,0.06)');
        ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

        const t = Date.now()/1000;
        for (let s of stars){
          // twinkle
          const alpha = s.a * (0.6 + 0.4 * Math.sin(t*1.2 + s.tw));
          // parallax from mouse
          const dx = (mouseX - w/2) / (w) * (s.r*6);
          const dy = (mouseY - h/2) / (h) * (s.r*6);
          s.x += s.vx + dx*0.002;
          s.y += s.vy + dy*0.002;
          if (s.x < -10) s.x = w + 10;
          if (s.x > w + 10) s.x = -10;
          if (s.y < -10) s.y = h + 10;
          if (s.y > h + 10) s.y = -10;

          ctx.beginPath();
          ctx.fillStyle = `rgba(255,255,255,${alpha})`;
          ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
          ctx.fill();
        }

        requestAnimationFrame(draw);
      }
      draw();
    })();

    // OPTIONAL: allow replacing brand image via JS data-src attribute if you want dynamic replace
    (function placeholderSetup(){
      const brandImg = document.getElementById('brandImg');
      // If you prefer, replace the src directly in HTML. Otherwise you can set data-src and uncomment below:
      // const dataSrc = brandImg.getAttribute('data-src');
      // if (dataSrc) brandImg.src = dataSrc;
      // Keep alt text helpful:
      brandImg.alt = brandImg.alt || 'TeamGalaxy logo';
    })();

  </script>
</body>
</html>